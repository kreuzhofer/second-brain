# ===========================================
# Second Brain - Environment Configuration
# ===========================================
# Copy this file to .env and fill in your values

# -------------------------------------------
# Required Variables
# -------------------------------------------

# OpenAI API key for LLM-powered classification
OPENAI_API_KEY=sk-your-openai-api-key-here

# PostgreSQL connection string
DATABASE_URL=postgresql://secondbrain:secondbrain@db:5432/secondbrain

# API authentication key (generate a secure random string) with openssl
# Example: openssl rand -base64 32
API_KEY=your-secure-api-key-here

# Optional legacy memory directory (used only for migration/backups)
# Examples:
#   DATA_PATH=~/second-brain-memory
#   DATA_PATH=/mnt/data/second-brain
DATA_PATH=./memory

# -------------------------------------------
# Optional Variables (with defaults)
# -------------------------------------------

# Timezone for scheduled jobs and timestamps
# Default: Europe/Berlin
TIMEZONE=Europe/Berlin

# Server port
# Default: 3002
PORT=3002

# Toggle audit logging to the database
# Default: true (set to false to disable)
# AUDIT_LOG_ENABLED=true

# -------------------------------------------
# Chat Configuration
# -------------------------------------------

# Confidence threshold for auto-classification
# Entries below this threshold go to inbox
# Default: 0.6
CONFIDENCE_THRESHOLD=0.6

# Maximum number of recent messages to include verbatim in context
# Default: 15
MAX_VERBATIM_MESSAGES=15

# Number of messages per summarization batch
# Default: 10
SUMMARIZE_BATCH_SIZE=10

# -------------------------------------------
# Search & Embeddings (Optional)
# -------------------------------------------

# Enable semantic search (requires OpenAI API key)
# Default: true
# SEMANTIC_SEARCH_ENABLED=true

# Semantic match threshold (0-1)
# Default: 0.75
# SEMANTIC_SEARCH_THRESHOLD=0.75

# Hybrid search weights (must sum to 1.0)
# Default: KEYWORD=0.4, SEMANTIC=0.6
# KEYWORD_SEARCH_WEIGHT=0.4
# SEMANTIC_SEARCH_WEIGHT=0.6

# Embedding model and max characters to embed
# Default: text-embedding-3-large, 4000
# EMBEDDING_MODEL=text-embedding-3-large
# EMBEDDING_MAX_CHARS=4000

# Embedding backfill (optional)
# Automatically backfill missing embeddings on startup
# EMBEDDING_BACKFILL_ENABLED=true
# EMBEDDING_BACKFILL_CATEGORY=
# EMBEDDING_BACKFILL_LIMIT=
# EMBEDDING_BACKFILL_BATCH_SIZE=10
# EMBEDDING_BACKFILL_SLEEP_MS=0
# MEMORY_MIGRATION_ENABLED=true
# MEMORY_MIGRATION_FORCE=false

# Duplicate detection thresholds
# Default: semantic 0.88, name 0.8
# DUPLICATE_SEMANTIC_THRESHOLD=0.88
# DUPLICATE_NAME_THRESHOLD=0.8

# -------------------------------------------
# Email Channel (Optional)
# -------------------------------------------
# The email channel is completely optional. When not configured,
# the application functions normally without email capabilities.
# Email is enabled only when ALL SMTP and IMAP variables are set.
#
# At startup, the app verifies connectivity to both servers and logs:
#   "SMTP: connection verified ✓" or error message
#   "IMAP: connection verified ✓" or error message

# SMTP Configuration (for sending emails)
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your-email@gmail.com
# SMTP_PASS=your-app-specific-password
#
# SMTP_SECURE - TLS mode (optional, auto-detected from port if not set)
#   Port 465: secure=true (implicit TLS - encrypted from start)
#   Port 587: secure=false (STARTTLS - upgrades to TLS after connect)
#   Set explicitly to override: true/false, yes/no, 1/0
# SMTP_SECURE=false

# IMAP Configuration (for receiving emails)
# IMAP_HOST=imap.gmail.com
# IMAP_PORT=993
# IMAP_USER=your-email@gmail.com
# IMAP_PASS=your-app-specific-password

# Email polling interval in seconds
# Default: 60
# EMAIL_POLL_INTERVAL=60

# -------------------------------------------
# Digest Email Delivery (Optional)
# -------------------------------------------
# Email address to receive daily digests and weekly reviews
# Requires email channel to be configured above
# DIGEST_RECIPIENT_EMAIL=your-email@example.com

# Skip chat delivery of digests when email is configured
# When true (default), digests are only sent via email, not to chat
# Set to false to receive digests in both email and chat
# DIGEST_SKIP_CHAT_WHEN_EMAIL=true

# -------------------------------------------
# Webhooks (Optional)
# -------------------------------------------

# Comma-separated list of webhook URLs
# WEBHOOK_URLS=https://example.com/webhook,https://hooks.example.com/second-brain

# Shared secret for signing (HMAC SHA-256)
# WEBHOOK_SECRET=your-shared-secret

# Delivery settings
# WEBHOOK_TIMEOUT_MS=5000
# WEBHOOK_MAX_RETRIES=3
# WEBHOOK_RETRY_BASE_MS=500

# -------------------------------------------
# Offline Queue (Optional)
# -------------------------------------------
# Queue capture requests when LLM is unavailable.
# Default: enabled
# OFFLINE_QUEUE_ENABLED=true
# OFFLINE_QUEUE_REPLAY_INTERVAL_SEC=60
# OFFLINE_QUEUE_PROCESSING_TIMEOUT_SEC=300
# OFFLINE_QUEUE_RETRY_BASE_SEC=30
# OFFLINE_QUEUE_MAX_ATTEMPTS=6
# OFFLINE_QUEUE_DEDUPE_TTL_HOURS=24

# -------------------------------------------
# Entry Revision Retention (Optional)
# -------------------------------------------
# Maximum number of revisions to keep per entry
# Default: 50
# ENTRY_REVISION_MAX_PER_ENTRY=50
#
# Maximum age of revisions in days (optional)
# ENTRY_REVISION_MAX_DAYS=90

# -------------------------------------------
# Deep Focus Music (Optional)
# -------------------------------------------
# YouTube Data API key for focus music discovery
# YOUTUBE_API_KEY=your-youtube-api-key
#
# Comma-separated search terms for discovery
# FOCUS_MUSIC_SEARCH_TERMS=deep focus music,focus music,ambient focus,lofi focus
#
# Results to fetch per discovery query
# Default: 10
# FOCUS_MUSIC_RESULTS_LIMIT=10
